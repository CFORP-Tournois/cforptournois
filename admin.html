<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  
  <title>Admin Panel - Le Centre franco</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="assets/images/logo-only.png">
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  
  <!-- Main Stylesheet -->
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/bracket.css">

  <!-- Supabase Client (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  
  <!-- LOGIN SCREEN -->
  <div id="loginScreen" style="min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #005CA9 0%, #004a8a 100%);">
    <div style="background: white; padding: 3rem; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); max-width: 400px; width: 90%;">
      <img src="assets/images/logo-full.png" alt="Le Centre franco" style="width: 200px; margin: 0 auto 2rem; display: block;">
      <h1 style="text-align: center; color: #005CA9; margin-bottom: 2rem;">Admin Panel</h1>
      
      <form id="loginForm">
        <div class="form-group">
          <label for="adminPassword" class="form-label">Password</label>
          <input 
            type="password" 
            id="adminPassword" 
            class="form-input"
            placeholder="Enter admin password"
            required
            autocomplete="current-password"
          >
        </div>
        
        <button type="submit" class="btn btn-primary" style="width: 100%;">
          Login
        </button>
        
        <div id="loginError" class="form-error hidden" style="margin-top: 1rem;"></div>
      </form>
      
      <p style="text-align: center; margin-top: 2rem; font-size: 0.875rem; color: #666;">
        <a href="index.html" style="color: #005CA9;">‚Üê Back to Home</a>
      </p>
    </div>
  </div>

  <!-- ADMIN INTERFACE -->
  <div id="adminInterface" class="hidden">
    
    <!-- HEADER -->
    <header class="header" role="banner">
      <div class="header-container">
        <!-- Logo -->
        <a href="index.html" class="logo-container">
          <img src="assets/images/logo-only.png" alt="Le Centre franco logo" class="logo-img">
          <div class="logo-text">
            <h1 class="logo-title">Admin Panel</h1>
            <p class="logo-subtitle">Le Centre franco</p>
          </div>
        </a>
        
        <!-- Admin Navigation -->
        <nav role="navigation">
          <ul class="nav-menu">
            <li><a href="index.html" class="nav-link">üè† Home</a></li>
            <li><a href="bracket.html" class="nav-link" target="_blank">üëÅÔ∏è View Brackets</a></li>
            <li>
              <button id="logoutBtn" class="btn btn-accent" style="padding: 0.5rem 1rem;">Logout</button>
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <!-- MAIN ADMIN CONTENT -->
    <main class="section">
      <div class="container" style="max-width: 1400px;">
        
        <!-- Admin Tabs -->
        <div style="display: flex; gap: 1rem; margin-bottom: 2rem; border-bottom: 2px solid #e0e0e0; flex-wrap: wrap;">
          <button class="admin-tab active" data-tab="participants">
            üë• Participants
          </button>
          <button class="admin-tab" data-tab="results">
            üèÜ Enter Results
          </button>
          <button class="admin-tab" data-tab="brackets">
            üå≥ Manage Brackets
          </button>
          <button class="admin-tab" data-tab="tournaments">
            ‚öôÔ∏è Manage Tournaments
          </button>
        </div>

        <!-- TAB 1: PARTICIPANTS -->
        <div id="tab-participants" class="admin-tab-content">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
            <h2>Participant Management</h2>
            <div style="display: flex; gap: 1rem;">
              <select id="filterTournament" class="form-select" style="width: auto;">
                <option value="all">All Tournaments</option>
                <option value="pvp">RIVALS (13-18)</option>
                <option value="all-ages">Racing (All Ages)</option>
              </select>
              <button class="btn btn-secondary" onclick="window.location.reload()">üîÑ Refresh</button>
              <button class="btn btn-primary" id="exportBtn">üì• Export CSV</button>
            </div>
          </div>

          <div class="table-container">
            <table class="table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Roblox Username</th>
                  <th>Tournament</th>
                  <th>Signup Time</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="participantsTableBody">
                <tr>
                  <td colspan="6" style="text-align: center; padding: 2rem; color: #666;">
                    Loading participants...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- TAB 2: ENTER RESULTS -->
        <div id="tab-results" class="admin-tab-content hidden">
          <h2 style="margin-bottom: 2rem;">Enter Tournament Results</h2>
          
          <!-- Tournament Selection -->
          <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 2rem;">
            <div class="form-group">
              <label class="form-label">Select Tournament</label>
              <select id="resultsTournament" class="form-select">
                <option value="">-- Choose Tournament --</option>
                <option value="pvp">RIVALS (13-18 ans)</option>
                <option value="all-ages">Racing (All Ages)</option>
              </select>
            </div>
            
            <div class="form-group">
              <label class="form-label">Round Number</label>
              <input type="number" id="resultsRound" class="form-input" value="1" min="1" max="10">
            </div>
            
            <button class="btn btn-primary" id="loadResultsBtn">Load Participants</button>
          </div>

          <!-- Results Entry Form -->
          <div id="resultsEntryContainer" class="hidden">
            <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
              <h3 style="margin-bottom: 1.5rem;">
                Round <span id="displayRound">1</span> Results
              </h3>
              
              <p style="margin-bottom: 1.5rem; padding: 1rem; background: #E3F2FD; border-radius: 8px; border-left: 4px solid #005CA9;">
                <strong>Instructions:</strong> Enter the placement number (1, 2, 3...) in the box next to each participant's name. 
                1st place = 1, 2nd place = 2, etc. Then click "Save Results".
              </p>
              
              <div class="table-container">
                <table class="table">
                  <thead>
                    <tr>
                      <th style="width: 50px;">#</th>
                      <th>Participant</th>
                      <th style="width: 150px;">Placement</th>
                      <th style="width: 100px;">Points</th>
                    </tr>
                  </thead>
                  <tbody id="resultsTableBody">
                    <!-- Results entry rows will be inserted here -->
                  </tbody>
                </table>
              </div>
              
              <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: flex-end;">
                <button class="btn btn-outline" id="clearResultsBtn">Clear All</button>
                <button class="btn btn-primary" id="saveResultsBtn">üíæ Save Results</button>
              </div>
              
              <div id="resultsSaved" class="hidden" style="margin-top: 1rem; padding: 1rem; background: #E8F5E9; border-radius: 8px; color: #2E7D32; text-align: center;">
                ‚úÖ Results saved successfully! Brackets updated.
              </div>
            </div>
          </div>

          <!-- VIEW/EDIT EXISTING RESULTS -->
          <div id="existingResultsContainer" class="hidden" style="margin-top: 3rem;">
            <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h3>Existing Results</h3>
                <div style="display: flex; gap: 1rem; align-items: center;">
                  <label class="form-label" style="margin: 0;">Filter by Round:</label>
                  <select id="filterRound" class="form-select" style="width: auto;">
                    <option value="all">All Rounds</option>
                  </select>
                  <button class="btn btn-secondary" id="refreshExistingBtn">üîÑ Refresh</button>
                </div>
              </div>
              
              <div class="table-container">
                <table class="table">
                  <thead>
                    <tr>
                      <th style="width: 80px;">Round</th>
                      <th>Participant</th>
                      <th style="width: 120px;">Placement</th>
                      <th style="width: 120px;">Points</th>
                      <th style="width: 150px;">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="existingResultsBody">
                    <!-- Existing results will be inserted here -->
                  </tbody>
                </table>
              </div>
              
              <div id="noExistingResults" class="hidden" style="text-align: center; padding: 3rem; color: #666;">
                <p style="font-size: 1.125rem; margin-bottom: 0.5rem;">üìä No results found</p>
                <p style="font-size: 0.875rem;">Enter results above to see them here.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- TAB 3: MANAGE BRACKETS -->
        <div id="tab-brackets" class="admin-tab-content hidden">
          <h2 style="margin-bottom: 2rem;">Bracket Management</h2>
          
          <!-- Tournament Selection -->
          <div style="max-width: 600px; margin-bottom: 2rem;">
            <div class="form-group">
              <label class="form-label">Select Tournament</label>
              <select id="bracketTournament" class="form-select">
                <option value="">-- Select Tournament --</option>
                <!-- Will be populated dynamically -->
              </select>
            </div>
          </div>

          <!-- Bracket Status Display -->
          <div id="bracketStatus" class="hidden" style="margin-bottom: 2rem; padding: 1.5rem; background: #E3F2FD; border-radius: 8px; border-left: 4px solid #005CA9;">
            <h3 style="margin-bottom: 1rem;">Bracket Information</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
              <div>
                <strong>Tournament:</strong> <span id="bracketTournamentName">-</span>
              </div>
              <div>
                <strong>Bracket Style:</strong> <span id="bracketStyle">-</span>
              </div>
              <div>
                <strong>Total Participants:</strong> <span id="bracketTotalParticipants">-</span>
              </div>
              <div>
                <strong>Bracket Status:</strong> <span id="bracketCurrentStatus">-</span>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div id="bracketActions" class="hidden" style="margin-bottom: 2rem; display: flex; gap: 1rem; flex-wrap: wrap;">
            <button class="btn btn-primary" id="generateBracketBtn">
              ‚ö° Generate Bracket
            </button>
            <button class="btn btn-outline" id="viewBracketBtn">
              üëÅÔ∏è View Bracket
            </button>
            <button class="btn btn-accent" id="deleteBracketBtn">
              üóëÔ∏è Delete Bracket
            </button>
          </div>

          <!-- Generate Bracket Form -->
          <div id="generateBracketForm" class="hidden" style="margin-bottom: 2rem; padding: 1.5rem; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="margin-bottom: 1.5rem;">Generate Elimination Bracket</h3>
            
            <p style="margin-bottom: 1rem; color: #666;">
              For <strong>Mixed</strong> tournaments: Select top finishers from FFA rounds to advance to elimination bracket.<br>
              For <strong>Head-to-Head</strong> tournaments: Use all registered participants.
            </p>

            <div class="form-group">
              <label class="form-label">Number of Players in Bracket</label>
              <select id="bracketSize" class="form-select">
                <option value="4">4 Players (Semi-finals)</option>
                <option value="8" selected>8 Players (Quarter-finals)</option>
                <option value="16">16 Players (Round of 16)</option>
                <option value="32">32 Players (Round of 32)</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Seeding Method</label>
              <select id="seedingMethod" class="form-select">
                <option value="points">By Points (FFA Leaderboard)</option>
                <option value="random">Random Seeding</option>
                <option value="manual">Manual Seeding</option>
              </select>
              <p class="form-help">For mixed tournaments, use "By Points" to seed based on FFA results</p>
            </div>

            <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
              <button class="btn btn-outline" id="cancelGenerateBracket">Cancel</button>
              <button class="btn btn-primary" id="confirmGenerateBracket">‚úì Generate Bracket</button>
            </div>
          </div>

          <!-- Bracket Display/Management -->
          <div id="bracketDisplay" class="hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
              <h3>Bracket Matches</h3>
              <div style="display: flex; gap: 0.5rem;">
                <button class="btn btn-outline" id="refreshBracket" style="padding: 0.5rem 1rem;">
                  üîÑ Refresh
                </button>
              </div>
            </div>

            <div id="bracketMatchesContainer">
              <!-- Bracket matches will be displayed here -->
            </div>
          </div>

          <!-- Empty State -->
          <div id="bracketEmpty" class="hidden" style="text-align: center; padding: 3rem; background: #f5f5f5; border-radius: 12px;">
            <p style="font-size: 3rem; margin-bottom: 1rem;">üå≥</p>
            <h3 style="margin-bottom: 0.5rem;">No Bracket Generated</h3>
            <p style="color: #666;">Select a tournament above to generate or manage brackets</p>
          </div>
        </div>

        <!-- TAB 4: MANAGE TOURNAMENTS -->
        <div id="tab-tournaments" class="admin-tab-content hidden">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
            <h2>Tournament Management</h2>
            <button class="btn btn-primary" id="createTournamentBtn">‚ûï Create New Tournament</button>
          </div>

          <!-- Tournaments Table -->
          <div class="table-container">
            <table class="table">
              <thead>
                <tr>
                  <th>Name (FR/EN)</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Type</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="tournamentsTableBody">
                <tr>
                  <td colspan="5" style="text-align: center; padding: 2rem; color: #666;">
                    Loading tournaments...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Tournament Form Modal -->
          <div id="tournamentFormModal" class="modal hidden">
            <div class="modal-content" style="max-width: 800px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2 id="tournamentFormTitle">Create New Tournament</h2>
                <button class="btn btn-outline" id="closeTournamentModal" style="padding: 0.5rem 1rem;">‚úï</button>
              </div>

              <form id="tournamentForm">
                <input type="hidden" id="tournamentId" value="">

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                  <!-- French Column -->
                  <div>
                    <h3 style="margin-bottom: 1rem; color: #005CA9;">üá´üá∑ Fran√ßais</h3>
                    
                    <div class="form-group">
                      <label class="form-label form-label-required">Name (French)</label>
                      <input type="text" id="nameFr" class="form-input" required>
                    </div>

                    <div class="form-group">
                      <label class="form-label">Subtitle (French)</label>
                      <input type="text" id="subtitleFr" class="form-input" placeholder="e.g., 13-18 ans">
                    </div>

                    <div class="form-group">
                      <label class="form-label">Description (French)</label>
                      <textarea id="descriptionFr" class="form-input" rows="3"></textarea>
                    </div>

                    <div class="form-group">
                      <label class="form-label">Format (French)</label>
                      <input type="text" id="formatFr" class="form-input" placeholder="e.g., FFA / √âlimination">
                    </div>
                  </div>

                  <!-- English Column -->
                  <div>
                    <h3 style="margin-bottom: 1rem; color: #005CA9;">üá¨üáß English</h3>
                    
                    <div class="form-group">
                      <label class="form-label form-label-required">Name (English)</label>
                      <input type="text" id="nameEn" class="form-input" required>
                    </div>

                    <div class="form-group">
                      <label class="form-label">Subtitle (English)</label>
                      <input type="text" id="subtitleEn" class="form-input" placeholder="e.g., Ages 13-18">
                    </div>

                    <div class="form-group">
                      <label class="form-label">Description (English)</label>
                      <textarea id="descriptionEn" class="form-input" rows="3"></textarea>
                    </div>

                    <div class="form-group">
                      <label class="form-label">Format (English)</label>
                      <input type="text" id="formatEn" class="form-input" placeholder="e.g., FFA / Elimination">
                    </div>
                  </div>
                </div>

                <!-- Common Fields -->
                <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 2px solid #e0e0e0;">
                  <h3 style="margin-bottom: 1rem; color: #005CA9;">‚öôÔ∏è Settings</h3>
                  
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                    <div class="form-group">
                      <label class="form-label">Game Platform</label>
                      <input type="text" id="gamePlatform" class="form-input" value="Roblox">
                    </div>

                    <div class="form-group">
                      <label class="form-label form-label-required">Tournament Type</label>
                      <select id="tournamentType" class="form-select" required>
                        <option value="pvp">PvP / Combat</option>
                        <option value="all-ages">All Ages / Racing</option>
                        <option value="custom">Custom</option>
                      </select>
                    </div>

                    <div class="form-group">
                      <label class="form-label form-label-required">Bracket Style</label>
                      <select id="bracketStyle" class="form-select" required>
                        <option value="scoreboard">Scoreboard (Points/Leaderboard)</option>
                        <option value="head-to-head">Head-to-Head (Elimination Bracket)</option>
                        <option value="mixed">Mixed (FFA + Bracket)</option>
                      </select>
                      <p class="form-help">Choose how results are displayed: scoreboard for racing/points, H2H for 1v1 elimination, mixed for FFA rounds then bracket</p>
                    </div>

                    <div class="form-group">
                      <label class="form-label form-label-required">Tournament Date</label>
                      <input type="datetime-local" id="tournamentDate" class="form-input" required>
                    </div>

                    <div class="form-group">
                      <label class="form-label">Time Display</label>
                      <input type="text" id="tournamentTime" class="form-input" placeholder="e.g., 14h00 - 16h00">
                    </div>

                    <div class="form-group">
                      <label class="form-label">Max Participants</label>
                      <input type="number" id="maxParticipants" class="form-input" min="1">
                    </div>

                    <div class="form-group">
                      <label class="form-label form-label-required">Status</label>
                      <select id="tournamentStatus" class="form-select" required>
                        <option value="draft">Draft</option>
                        <option value="published">Published</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                        <option value="archived">Archived</option>
                      </select>
                    </div>

                    <div class="form-group">
                      <label class="form-label">Display Order</label>
                      <input type="number" id="displayOrder" class="form-input" value="1" min="0">
                    </div>
                  </div>
                </div>

                <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: flex-end;">
                  <button type="button" class="btn btn-outline" id="cancelTournamentBtn">Cancel</button>
                  <button type="submit" class="btn btn-primary" id="saveTournamentBtn">üíæ Save Tournament</button>
                </div>
              </form>
            </div>
          </div>

        </div>

      </div>
    </main>

  </div>

  <!-- SCRIPTS -->
  <script src="js/config.js"></script>
  <script src="js/i18n.js"></script>
  <script src="js/bracket-admin.js"></script>
  <script src="js/admin.js"></script>

  <style>
    /* Admin-specific styles */
    .admin-tab {
      background: transparent;
      border: none;
      padding: 1rem 1.5rem;
      font-weight: 600;
      color: #666;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
    }
    
    .admin-tab:hover {
      color: #005CA9;
    }
    
    .admin-tab.active {
      color: #005CA9;
      border-bottom-color: #E6007E;
    }
    
    .admin-tab-content {
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .placement-input {
      width: 80px;
      padding: 0.5rem;
      font-size: 1rem;
      font-weight: 600;
      text-align: center;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      transition: border-color 0.2s ease;
    }
    
    .placement-input:focus {
      outline: none;
      border-color: #005CA9;
      box-shadow: 0 0 0 3px rgba(0, 92, 169, 0.1);
    }
    
    .placement-input[data-placement="1"] {
      border-color: #FFD700;
      background: #FFFBF0;
    }
    
    .placement-input[data-placement="2"] {
      border-color: #C0C0C0;
      background: #F5F5F5;
    }
    
    .placement-input[data-placement="3"] {
      border-color: #CD7F32;
      background: #FFF5E6;
    }
    
    .points-display {
      font-weight: 700;
      color: #8DC63F;
      font-size: 1.125rem;
    }
    
    /* Modal Styles */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      animation: fadeIn 0.2s ease;
    }
    
    .modal.hidden {
      display: none;
    }
    
    .modal-content {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      max-height: 90vh;
      overflow-y: auto;
      width: 90%;
      animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
      from { transform: translateY(-20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    /* Badge Styles */
    .badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .badge-success {
      background: #d4edda;
      color: #155724;
    }
    
    .badge-info {
      background: #d1ecf1;
      color: #0c5460;
    }
    
    .badge-secondary {
      background: #e2e3e5;
      color: #383d41;
    }
  </style>

</body>
</html>
